sudo: required
language: bash
services:
  - docker

before_script:
  - export APP_IMAGE=keboola-component
  - docker build . --tag=$APP_IMAGE

after_success:
  - docker images

deploy:
  provider: script
  skip_cleanup: true
  script: |
    echo "--- Debugging deploy.sh ---"
    
    # KLÍČOVÁ OPRAVA: Přidání cesty pro Ruby gems do PATH
    # Tento řádek zajistí, že Bash najde `kbc-developer-portal`
    export PATH="$(ruby -r rubygems -e 'puts Gem.user_dir')/bin:$PATH" || { echo "Failed to add Ruby gem path to PATH."; exit 1; }
    
    echo "Current PATH: $PATH" # Pro ověření, že PATH je správně rozšířena
    
    # Ověření, zda je kbc-developer-portal nyní dostupný
    which kbc-developer-portal || { echo "Error: kbc-developer-portal command not found after PATH update."; exit 1; }
    
    chmod +x ./deploy.sh # Zajistíme spustitelná práva
    bash -e -x ./deploy.sh # Explicitně spustíme s debugem a chybovým ukončením
    echo "--- Debugging deploy.sh Finished ---"
  on:
    tags: true
